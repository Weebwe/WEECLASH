<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>WEE CLASH</title>

    <link rel="icon" href="ico.png" type="image/png">
    <link rel="apple-touch-icon" href="ico.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000"/> 

    <style>
        /* ... (Your existing CSS here) ... */

        /* Add a small spinner or placeholder for avatar loading */
        .loading-avatar {
            border: 0.2vh solid #f3f3f3; /* Light grey */
            border-top: 0.2vh solid #f1c40f; /* Yellow */
            border-radius: 50%;
            width: 5vh;
            height: 5vh;
            animation: spin 1s linear infinite;
            display: inline-block; /* Or block, depending on layout */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Style for the Telegram login button if you customize it */
        .telegram-login-button {
            margin-top: 1vh; /* Adjust as needed */
            padding: 1vh 2vw;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 0.8vh;
            cursor: pointer;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5vw;
            box-shadow: 0 0.5vh 1.5vh rgba(0,0,0,0.5);
            transition: background-color 0.2s, transform 0.2s;
        }

        .telegram-login-button:hover {
            background-color: #007bb5;
            transform: translateY(-0.2vh);
        }

        .telegram-login-button img {
            height: 2vh; /* Adjust icon size */
            width: auto;
        }

        /* Adjustments for when no user is logged in */
        .user-profile-info.logged-out {
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .user-profile-info.logged-out .avatar,
        .user-profile-info.logged-out .hero-level,
        .user-profile-info.logged-out span {
            display: none; /* Hide placeholder elements when logged out */
        }

    </style>
</head>
<body>

    <div id="gameContainer">

        <div class="top-panel">
            <div class="user-profile-info" id="userProfileInfo"> 
                <img src="media/avatar.png" alt="–ê–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" class="avatar" id="userAvatar">
                <span id="userName">–£–≤—ñ–π–¥—ñ—Ç—å</span> 
                <span class="hero-level" id="heroLevel">1</span> </div>

            <div class="resource-and-power-container"> 
                <div class="resource-container">
                    <div class="resource-item">
                        <span class="emoji-icon">üå≥</span> <span>1250</span>
                    </div>
                    <div class="resource-item">
                        <span class="emoji-icon">ü™®</span> <span>875</span>
                    </div>
                    <div class="resource-item">
                        <span class="emoji-icon">üçé</span> <span>2100</span>
                    </div>
                    <div class="resource-item">
                        <span class="emoji-icon">üí∞</span> <span>500</span>
                    </div>
                    <div class="resource-item">
                        <span class="emoji-icon">‚ú®</span> <span>250</span>
                    </div>
                </div>
                <div class="total-power">üí™ 12345</div> 
            </div>
            
            <button id="settingsButton" aria-label="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∏">
                <span class="emoji-icon">‚öôÔ∏è</span>
            </button>
        </div>

        <div id="heroScreen" class="game-screen active"> 
            <h2 class="screen-title">–í–∞—à –ì–µ—Ä–æ–π</h2>
            <p>–¢—É—Ç –±—É–¥–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∞—à–æ–≥–æ –≥–µ—Ä–æ—è. –¶–µ –¥–æ–≤–≥–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—ñ, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–º—ñ—Å—Ç –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –º–µ–∂—ñ –µ–∫—Ä–∞–Ω—É —ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –π–æ–≥–æ –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏. –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ WEE CLASH!</p>
            <p>–í–∞—à—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —ñ–Ω–≤–µ–Ω—Ç–∞—Ä —Ç–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≥–µ—Ä–æ—è –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è —Ç—É—Ç. –ì–æ—Ç—É–π—Ç–µ—Å—è –¥–æ –ø—Ä–∏–≥–æ–¥!</p>
            <div id="telegramLoginContainer"></div>
        </div>
        
        </div>

    <audio id="backgroundMusic" src="media/background.mp3" loop preload="auto"></audio>
    <audio id="clickSound" src="media/click.mp3" preload="auto"></audio>

    <script>
        // ... (Your existing JavaScript) ...

        const userProfileInfo = document.getElementById('userProfileInfo');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const heroLevel = document.getElementById('heroLevel');
        const telegramLoginContainer = document.getElementById('telegramLoginContainer');

        // Function to update UI with user data
        function updateUserInfo(userData) {
            if (userData && userData.username) {
                // User is logged in
                userProfileInfo.classList.remove('logged-out');
                userAvatar.style.display = 'block'; // Show avatar
                userName.style.display = 'block';   // Show username
                heroLevel.style.display = 'block';  // Show hero level

                userName.textContent = userData.username;
                if (userData.photo_url) {
                    userAvatar.src = userData.photo_url;
                } else {
                    userAvatar.src = 'media/avatar.png'; // Fallback default avatar
                }
                // If you have a specific hero level for the user, set it here
                heroLevel.textContent = userData.heroLevel || '1'; // Example: get hero level from user data
                telegramLoginContainer.innerHTML = ''; // Clear login button if logged in
            } else {
                // User is not logged in
                userProfileInfo.classList.add('logged-out');
                userAvatar.style.display = 'none'; // Hide avatar
                userName.style.display = 'none';   // Hide username
                heroLevel.style.display = 'none';  // Hide hero level
                // Show Telegram login button
                telegramLoginContainer.innerHTML = `
                    <script async src="https://telegram.org/js/telegram-widget.js?22" 
                            data-telegram-login="YOUR_BOT_USERNAME" 
                            data-size="large" 
                            data-onauth="onTelegramAuth(user)" 
                            data-request-access="write"></script>
                `;
            }
        }

        // This function will be called by Telegram widget after successful login
        // It expects 'user' object from Telegram
        function onTelegramAuth(user) {
            // Send user data to your backend for verification and session management
            fetch('/api/telegram-auth', { // Replace with your actual backend endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(user),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Backend confirmed authenticity and returned user data
                    updateUserInfo(data.user); // Update UI with data from backend
                    console.log('User logged in:', data.user.username);
                    // You might want to store a session token/cookie here
                } else {
                    console.error('Telegram authentication failed on backend:', data.message);
                    updateUserInfo(null); // Show logged out state
                }
            })
            .catch(error => {
                console.error('Error during Telegram authentication:', error);
                updateUserInfo(null); // Show logged out state
            });
        }

        // On page load, check if the user is already logged in (e.g., via session/cookie)
        document.addEventListener('DOMContentLoaded', () => {
            backgroundMusic.play().catch(e => console.log("–ú—É–∑–∏–∫–∞ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–µ–∑ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", e));

            // Example: Fetch user data from your backend to see if they are already logged in
            fetch('/api/get-current-user') // Replace with your actual backend endpoint
                .then(response => response.json())
                .then(data => {
                    if (data.user) {
                        updateUserInfo(data.user);
                    } else {
                        updateUserInfo(null); // No user logged in, display login button
                    }
                })
                .catch(error => {
                    console.error('Error fetching current user:', error);
                    updateUserInfo(null); // Assume no user if fetch fails
                });
        });

        // ... (Rest of your existing JavaScript) ...
    </script>

</body>
</html>
